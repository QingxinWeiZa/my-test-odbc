import{h as N,S as ee,a as te,_ as ne,b as ae,c as oe,d as se,e as ie,F as ue,C as le,f as re,g as V,p as ce}from"./http-DzxoruXy.js";import{u as H,o as P,n as de,g as fe,a as pe,b as s,c as q,d as $,r as k,w as L,e as he,f as W,h as z,i as S,j as O,k as i,l as f,m as _e,p as me,q as R,s as j,F as E,t as F,v as ye,x as ve,y as be,z as ge,A as ke,_ as we}from"./index-BtU2wmtS.js";import{B as xe}from"./index-BPRX2Vsd.js";function Se(){return[{key:"0",dataIndex:"yearMonth",title:"年月",width:100,align:"center"},{key:"1",title:"台数",children:[{key:"1-1",title:"小売り",children:[{key:"1-1-1",dataIndex:"kouriJuchuuDaisuu",title:"受注",width:"20%",align:"center"},{key:"1-1-2",dataIndex:"kouriHanbaiDaisuu",title:"販売",width:"20%",align:"center"}]},{key:"1-2",dataIndex:"oroshiDaisuu",title:"卸",width:"20%",align:"center"}]},{key:"2",title:"売上（千円）",children:[{key:"2-1",dataIndex:"kouriShueki",title:"小売り",width:"20%",align:"center"},{key:"2-2",dataIndex:"oroshiShueki",title:"卸",width:"20%",align:"center"}]}]}function Ce(e,n){const o=H();return N.request({url:"/api/salesPlan/get",params:{cdTenpo:o.userInfo.cdTenpo,year:e},method:"get"},n)}function Me(e,n){const o=H();return N.request({url:"/api/salesPlan/update",data:Object.assign({cdTenpo:o.userInfo.cdTenpo},e)},n)}function Ie(e){return fe()?(pe(e),!0):!1}function Re(e){return typeof e=="function"?e():s(e)}const Oe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function $e(e){return q()}function Be(e,n=!0,o){$e()?P(e,o):n?e():de(e)}function C(e){var n;const o=Re(e);return(n=o==null?void 0:o.$el)!=null?n:o}const U=Oe?window:void 0;function De(){const e=k(!1),n=q();return n&&P(()=>{e.value=!0},n),e}function je(e){const n=De();return $(()=>(n.value,!!e()))}function Ee(e,n,o={}){const{window:y=U,...d}=o;let p;const h=je(()=>y&&"ResizeObserver"in y),l=()=>{p&&(p.disconnect(),p=void 0)},v=$(()=>Array.isArray(e)?e.map(t=>C(t)):[C(e)]),M=L(v,t=>{if(l(),h.value&&y){p=new ResizeObserver(n);for(const r of t)r&&p.observe(r,d)}},{immediate:!0,flush:"post"}),b=()=>{l(),M()};return Ie(b),{isSupported:h,stop:b}}function Pe(e,n={width:0,height:0},o={}){const{window:y=U,box:d="content-box"}=o,p=$(()=>{var t,r;return(r=(t=C(e))==null?void 0:t.namespaceURI)==null?void 0:r.includes("svg")}),h=k(n.width),l=k(n.height),{stop:v}=Ee(e,([t])=>{const r=d==="border-box"?t.borderBoxSize:d==="content-box"?t.contentBoxSize:t.devicePixelContentBoxSize;if(y&&p.value){const w=C(e);if(w){const g=w.getBoundingClientRect();h.value=g.width,l.value=g.height}}else if(r){const w=Array.isArray(r)?r:[r];h.value=w.reduce((g,{inlineSize:I})=>g+I,0),l.value=w.reduce((g,{blockSize:I})=>g+I,0)}else h.value=t.contentRect.width,l.value=t.contentRect.height},o);Be(()=>{const t=C(e);t&&(h.value="offsetWidth"in t?t.offsetWidth:n.width,l.value="offsetHeight"in t?t.offsetHeight:n.height)});const M=L(()=>C(e),t=>{h.value=t?n.width:0,l.value=t?n.height:0});function b(){v(),M()}return{width:h,height:l,stop:b}}const Te=e=>(be("data-v-f02b46bb"),e=e(),ge(),e),Ye=Te(()=>ke("h3",{class:"font-600"},"販売計画",-1)),Ae=he({__name:"index",setup(e){const n=k(),o=k(),{height:y}=Pe(o),d=W({}),p=["kouriJuchuuDaisuu","kouriHanbaiDaisuu","oroshiDaisuu","kouriShueki","oroshiShueki"],h=$(()=>{const a=Se();return a.push({key:"action",title:"操作",width:Object.keys(d).length?160:100,align:"center"}),a}),l=k(!1),v=k(z().year()),M=Array.from({length:11}).map((a,u)=>{const _=new Date().getFullYear();return{value:_-5+u,label:_-5+u+"年"}}),b=k([]),t=W({});function r(a){Object.keys(t).forEach(u=>{u.startsWith(a.yearMonth)&&delete t[u]}),delete d[a.yearMonth]}function w(a){d[a.yearMonth]=Object.assign({},a),Object.keys(a).forEach(u=>{u!=="yearMonth"&&(t[`${a.yearMonth}-${u}`]=a[u])})}function g(a){n.value.clearValidate();const u=p.map(_=>`${a.yearMonth}-${_}`);n.value.validateFields(u).then(()=>{const _=b.value.filter(c=>c.yearMonth==a.yearMonth)[0];p.forEach(c=>{_[c]=t[`${a.yearMonth}-${c}`]}),Me(_,l).then(c=>{c.success&&c.data?(r(a),B()):ve.error(c.message)})})}function I(){Object.keys(d).forEach(a=>{delete d[a]}),Object.keys(t).forEach(a=>{delete t[a]}),B()}function B(){Ce(v.value,l).then(a=>{a.success&&a.data&&(b.value=a.data)})}return P(()=>{B()}),(a,u)=>{const _=ee,c=xe,T=te,Y=ne,A=ae,G=oe,J=se,K=ie,Q=ue,X=le;return S(),O(Y,{class:"h-full"},{default:i(()=>[f(X,{ref_key:"tableCardRef",ref:o},{title:i(()=>[f(Y,{justify:"space-between",align:"center"},{default:i(()=>[Ye,f(T,null,{default:i(()=>[f(_,{class:"w-40",options:s(M),value:s(v),"onUpdate:value":u[0]||(u[0]=x=>_e(v)?v.value=x:null)},null,8,["options","value"]),f(c,{icon:me(s(re)),onClick:I},{default:i(()=>[R("検索")]),_:1},8,["icon"])]),_:1})]),_:1})]),default:i(()=>[f(Q,{name:"salesPlan",ref_key:"formRef",ref:n,model:s(t),layout:"inline"},{default:i(()=>[f(K,{size:"small",tableLayout:"fixed",bordered:"","text-align":"center",columns:s(h),scroll:{y:s(y)-220},"data-source":s(b),pagination:!1,loading:s(l)},{bodyCell:i(({column:x,record:m,value:Z})=>[x.key=="action"?(S(),j(E,{key:0},[s(d).hasOwnProperty(m.yearMonth)?(S(),O(T,{key:0},{default:i(()=>[f(A,{title:"保存しますか？",onConfirm:D=>g(m),"ok-text":"確認"},{default:i(()=>[f(c,{type:"primary"},{default:i(()=>[R("保存")]),_:1})]),_:2},1032,["onConfirm"]),f(A,{title:"変更を破棄しますか？",onConfirm:D=>r(m),"ok-text":"確認"},{default:i(()=>[f(c,null,{default:i(()=>[R("破棄")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):(S(),O(c,{key:1,type:"primary",onClick:()=>w(m),disabled:s(z)().format("YYYY-MM")>m.yearMonth},{default:i(()=>[R(" 編集 ")]),_:2},1032,["onClick","disabled"]))],64)):F("",!0),p.includes(String(x.dataIndex))?(S(),j(E,{key:1},[s(d).hasOwnProperty(m.yearMonth)?(S(),O(J,{key:0,name:`${m.yearMonth}-${x.dataIndex}`,rules:{required:!0,message:"必須項目です。"}},{default:i(()=>[f(G,{value:s(t)[`${m.yearMonth}-${x.dataIndex}`],"onUpdate:value":D=>s(t)[`${m.yearMonth}-${x.dataIndex}`]=D,class:"table-inline-input",controls:!1,keyboard:!1,precision:0,formatter:s(V),parser:s(ce)},null,8,["value","onUpdate:value","formatter","parser"])]),_:2},1032,["name"])):(S(),j(E,{key:1},[R(ye(s(V)(Z)),1)],64))],64)):F("",!0)]),_:1},8,["columns","scroll","data-source","loading"])]),_:1},8,["model"])]),_:1},512)]),_:1})}}}),Fe=we(Ae,[["__scopeId","data-v-f02b46bb"]]);export{Fe as default};
